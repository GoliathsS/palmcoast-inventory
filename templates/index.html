<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Palm Coast Inventory Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <h1>üì¶ Palm Coast Inventory Dashboard</h1>

    <form action="/add-product" method="POST" style="display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">
        <input type="text" name="name" placeholder="Product Name" required>
        <input type="text" name="barcode" placeholder="Barcode" required>
        <input type="number" name="min_stock" placeholder="Min Stock" required>
        <input type="text" name="siteone_sku" placeholder="SiteOne SKU (optional)">
        <button type="submit">‚ûï Add Product</button>
    </form>

    <div class="settings-section">
        <button onclick="toggleSettings()">‚öôÔ∏è Settings</button>
        <div id="settings-panel" style="display: none; margin-top: 10px;">
            <h3>üë∑ Manage Technicians</h3>
            <form action="/add-technician" method="POST">
                <input type="text" name="tech_name" placeholder="Technician Name" required>
                <button type="submit">‚ûï Add Technician</button>
            </form>

            <form action="/remove-technician" method="POST" style="margin-top: 10px;">
                <select name="tech_name">
                    {% for tech in technicians %}
                        <option value="{{ tech }}">{{ tech }}</option>
                    {% endfor %}
                </select>
                <button type="submit">üóëÔ∏è Remove Technician</button>
            </form>
        </div>

        <div class="siteone-sync">
            <h3>üîÑ Sync SiteOne Prices</h3>
            <button onclick="toggleSyncForm()">üîß Start Manual Sync</button>
            <form id="syncForm" action="/sync-siteone" method="POST" style="display: none; margin-top: 10px;">
                <input type="email" name="email" placeholder="SiteOne Email" required>
                <input type="password" name="password" placeholder="Password" required>
                <button type="submit">‚ñ∂Ô∏è Start Sync</button>
            </form>
        </div>
    </div>

    <a href="/scan"><button>üì∑ Open Scanner</button></a>
    <a href="/history" style="float:right; font-size:0.8rem;">üìú View History</a>

    <table>
        <tr>
            <th>Product</th>
            <th>Barcode</th>
            <th>In Stock</th>
            <th>Min Stock</th>
            <th>Status</th>
            <th>Price</th>
            <th>Actions</th>
        </tr>
        {% for p in products %}
        <tr id="row-{{ p[0] }}" style="display:none;">
            <form action="/edit-product/{{ p[0] }}" method="POST" class="edit-form">
                <td><input type="text" name="name" value="{{ p[1] }}" required></td>
                <td><input type="text" name="barcode" value="{{ p[2] }}" required></td>
                <td>{{ p[3] }}</td>
                <td><input type="number" name="min_stock" value="{{ p[4] }}" required></td>
                <td class="{{ 'status-low' if p[3] < p[4] else 'status-ok' }}">
                    {{ 'Low' if p[3] < p[4] else 'OK' }}
                </td>
                <td>${{ '%.2f' | format(p[5] or 0.00) }}</td>
                <td>
                    <button type="submit">üíæ Save</button>
                    <button type="button" onclick="toggleEdit({{ p[0] }})">‚ùå Cancel</button>
                </td>
            </form>
        </tr>
        <tr class="view-row" id="view-{{ p[0] }}">
            <td>{{ p[1] }}</td>
            <td>{{ p[2] }}</td>
            <td>{{ p[3] }}</td>
            <td>{{ p[4] }}</td>
            <td class="{{ 'status-low' if p[3] < p[4] else 'status-ok' }}">
                {{ 'Low' if p[3] < p[4] else 'OK' }}
            </td>
            <td>${{ '%.2f' | format(p[5] or 0.00) }}</td>
            <td>
                <button onclick="toggleEdit({{ p[0] }})">‚úèÔ∏è Edit</button>
                <form action="/delete-product/{{ p[0] }}" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure?');">
                    <button type="submit">üóë Delete</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>

    <script>
        function toggleEdit(id) {
            const row = document.getElementById('row-' + id);
            const view = document.getElementById('view-' + id);
            row.style.display = row.style.display === 'none' ? 'table-row' : 'none';
            view.style.display = view.style.display === 'none' ? 'table-row' : 'none';
        }

        function toggleSettings() {
            const panel = document.getElementById("settings-panel");
            panel.style.display = panel.style.display === "none" ? "block" : "none";
        }

        function toggleSyncForm() {
            const form = document.getElementById("syncForm");
            form.style.display = form.style.display === "none" ? "block" : "none";
        }
    </script>
</body>
</html>
